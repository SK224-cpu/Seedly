<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Seedly Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root {
      --bg-light: #fdfcf7;
      --bg-dark: #1f1f1f;
      --text-light: #6D6A75;
      --text-dark: #e0e0e0;
      --card-light: #e1f5e4;
      --card-dark: #2c2c2c;
      --accent: #4caf50;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--bg-light);
      color: var(--text-light);
      transition: all 0.3s ease;
    }

    .dark-mode {
      background-color: var(--bg-dark) !important;
      color: var(--text-dark) !important;
    }

    .card {
      background-color: var(--card-light);
      border: none;
      border-radius: 12px;
      transition: all 0.3s ease;
      height: 100%;
    }

    .dark-mode .card {
      background-color: var(--card-dark);
    }

    .navbar {
      background-color: var(--accent);
    }

    .navbar-brand {
      color: #fff;
      font-weight: 600;
    }

    .toggle-switch {
      cursor: pointer;
    }

    .chart-container {
      position: relative;
      height: 300px;
    }

    .btn-export {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">ðŸŒ± Seedly Dashboard</a>
      <div class="form-check form-switch ms-auto">
        <input class="form-check-input toggle-switch" type="checkbox" id="darkToggle">
        <label class="form-check-label text-white" for="darkToggle">Dark Mode</label>
      </div>
    </div>
  </nav>

  <div class="container py-4">
    <div class="row mb-4">
      <div class="col-md-3">
        <h4>Select Tasks</h4>
        <div class="form-check"><input class="form-check-input task-toggle" type="checkbox" value="Task Completion" checked id="task1"><label class="form-check-label" for="task1">Task Completion</label></div>
        <div class="form-check"><input class="form-check-input task-toggle" type="checkbox" value="Water Intake" checked id="task2"><label class="form-check-label" for="task2">Water Intake</label></div>
        <div class="form-check"><input class="form-check-input task-toggle" type="checkbox" value="Reading Habit" checked id="task3"><label class="form-check-label" for="task3">Reading Habit</label></div>
        <div class="form-check"><input class="form-check-input task-toggle" type="checkbox" value="Workout Tracker" checked id="task4"><label class="form-check-label" for="task4">Workout Tracker</label></div>
      </div>
      <div class="col-md-3">
        <h4>Filter by Date</h4>
        <div class="input-group mb-2"><label class="input-group-text">Start</label><input type="number" min="1" max="31" class="form-control" id="startDay" value="1"></div>
        <div class="input-group"><label class="input-group-text">End</label><input type="number" min="1" max="31" class="form-control" id="endDay" value="30"></div>
        <select class="form-select mt-2" id="groupBy">
          <option value="daily">Daily</option>
          <option value="weekly">Weekly</option>
        </select>
      </div>
      <div class="col-md-3">
        <h4>Select Month/Year</h4>
        <select class="form-select mb-2" id="monthSelect">
          <option value="6">June</option>
          <option value="7">July</option>
          <option value="8">August</option>
        </select>
        <select class="form-select" id="yearSelect">
          <option value="2024">2024</option>
          <option value="2025" selected>2025</option>
        </select>
      </div>
      <div class="col-md-3">
        <h4>Chart Type</h4>
        <select class="form-select" id="chartType">
          <option value="bar">Bar</option>
          <option value="line">Line</option>
          <option value="area">Area (Stacked Line)</option>
        </select>
      </div>
    </div>

    <div class="card p-4 shadow-sm mb-4">
      <h4 class="mb-3">Combined Task Graph</h4>
      <div class="chart-container">
        <canvas id="combinedChart"></canvas>
      </div>
      <button class="btn btn-sm btn-outline-primary btn-export" onclick="downloadChart('combinedChart')">Download</button>
      <button class="btn btn-sm btn-outline-secondary btn-export" onclick="downloadPDF()">Export PDF</button>
    </div>
  </div>

  <script>
    const combinedCtx = document.getElementById('combinedChart').getContext('2d');

    const datasets = {
      "Task Completion": { label: "Task Done", data: [1,0,1,1,0,0,1,1,1,0,1,1,0,0,1,1,1,0,0,1,1,0,1,1,0,0,1,1,1,1], backgroundColor: "#4caf50" },
      "Water Intake": { label: "Water Intake", data: [1,1,0,1,1,1,0,0,1,1,1,0,1,1,0,1,1,0,1,1,0,0,1,1,1,0,1,1,1,1], backgroundColor: "#2196f3" },
      "Reading Habit": { label: "Reading", data: [1,1,0,1,1,0,0,1,1,1,1,0,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,1], backgroundColor: "#ff9800" },
      "Workout Tracker": { label: "Workout", data: [0,1,0,1,0,0,1,1,0,0,1,1,0,1,1,0,0,1,0,1,1,0,1,0,1,0,1,0,1,1], backgroundColor: "#9c27b0" }
    };

    let chart;

    function aggregateWeekly(data) {
      const result = [];
      for (let i = 0; i < data.length; i += 7) {
        const weekSum = data.slice(i, i + 7).reduce((a, b) => a + b, 0);
        result.push(weekSum);
      }
      return result;
    }

    function renderChart() {
      const typeSelection = document.getElementById('chartType').value;
      const type = typeSelection === 'bar' ? 'bar' : 'line';
      const fillArea = typeSelection === 'area';

      const groupBy = document.getElementById('groupBy').value;
      const start = parseInt(document.getElementById('startDay').value) - 1;
      const end = parseInt(document.getElementById('endDay').value);
      const month = parseInt(document.getElementById('monthSelect').value);
      const year = document.getElementById('yearSelect').value;

      const activeTasks = Array.from(document.querySelectorAll('.task-toggle:checked')).map(cb => cb.value);

      const labels = groupBy === 'weekly' ?
        Array.from({ length: Math.ceil((end - start) / 7) }, (_, i) => `Week ${i + 1}`) :
        Array.from({ length: end - start }, (_, i) => `${year}-${month.toString().padStart(2, '0')}-${(start + i + 1).toString().padStart(2, '0')}`);

      const selectedDatasets = activeTasks.map(key => {
        const raw = datasets[key];
        const sliced = raw.data.slice(start, end);
        const data = groupBy === 'weekly' ? aggregateWeekly(sliced) : sliced;
        return {
          label: raw.label,
          data,
          backgroundColor: raw.backgroundColor,
          borderColor: raw.backgroundColor,
          fill: fillArea,
        };
      });

      if (chart) chart.destroy();

      chart = new Chart(combinedCtx, {
        type,
        data: { labels, datasets: selectedDatasets },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            tooltip: {
              mode: 'index', intersect: false,
              callbacks: {
                label: (ctx) => `${ctx.dataset.label}: ${ctx.raw}`
              }
            },
            legend: { position: 'top' },
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { stepSize: 1 },
              suggestedMax: groupBy === 'weekly' ? 7 : 1
            }
          },
          elements: {
            line: { tension: 0.4 },
            point: { radius: 3 }
          }
        }
      });
    }

    document.querySelectorAll('.task-toggle, #startDay, #endDay, #chartType, #groupBy, #monthSelect, #yearSelect')
      .forEach(el => el.addEventListener('change', renderChart));

    renderChart();

    document.getElementById('darkToggle').addEventListener('change', function () {
      document.body.classList.toggle('dark-mode');
    });

    function downloadChart(id) {
      const link = document.createElement('a');
      link.download = `${id}.png`;
      link.href = document.getElementById(id).toDataURL('image/png');
      link.click();
    }

    async function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      const canvas = document.getElementById('combinedChart');
      const imgData = canvas.toDataURL('image/png');
      pdf.addImage(imgData, 'PNG', 15, 20, 180, 100);
      pdf.save("Seedly_Habit_Combined_Chart.pdf");
    }
  </script>
</body>
</html>
